<ui:composition template="/WEB-INF/templates/common/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <f:metadata>
        <f:viewAction action="#{userBean.pageCheck()}" />
    </f:metadata>

    <ui:define name="title">#{lang['title.User']}</ui:define>

    <ui:define name="inner">

        <h:form>

            <p:messages id="messages" closable="true" />

            <h:panelGroup styleClass="form-buttons aleft top-buttons" layout="block" rendered="#{userBean.isModifyAllowed()}" >
                <p:commandButton value="#{lang['button.Add']}"
                                 styleClass="button-green" action="#{userBean.gotoAdd()}"
                                 ajax="false" />
            </h:panelGroup>

            <p:dataTable var="user" value="#{userBean.users}" reflow="true" rows="10" paginator="true" paginatorPosition="bottom" >

                <f:facet name="header">
                    <h:outputText value="#{lang['label.UserList']}" /> 
                </f:facet>

                <p:column headerText="#{lang['label.Name']}" styleClass="wrap" >
                    <h:outputText value="#{user.firstName} #{user.lastName}" />
                </p:column>

                <p:column headerText="#{lang['label.Username']}" styleClass="wrap" >
                    <h:outputText value="#{user.username}" />
                </p:column>

                <p:column headerText="#{lang['label.Email']}" styleClass="wrap" >
                    <h:outputText value="#{user.email}" />
                </p:column>

                <p:column headerText="#{lang['label.Active']}" style="text-align: center;" styleClass="wrap" >
                    <h:outputText value="#{user.active eq 'Y' ? lang['label.Yes'] : lang['label.No']}" />
                </p:column>

                <p:column headerText="#{lang['label.Group']}" style="text-align: center;" styleClass="wrap" >
                    <h:outputText value="#{user.userGroup.name}" />
                </p:column>

                <p:column headerText="#{lang['label.Action']}" style="text-align: center;" styleClass="wrap" >
                    <h:panelGroup layout="block">
                        <p:commandButton value="#{lang['button.Edit']}" styleClass="button-green" action="#{userBean.gotoEdit(user.id)}" rendered="#{userBean.isModifyAllowed()}" />
                        <p:commandButton value="#{lang['button.Delete']}" styleClass="button-red" style="margin-left: 5px;" 
                                         actionListener="#{userBean.prepareRemoveUser(user.id)}"
                                         oncomplete="PF('dlgConfirmation').show()" 
                                         rendered="#{userBean.isModifyAllowed()}" />
                    </h:panelGroup>
                </p:column>

            </p:dataTable>

        </h:form>

        <p:confirmDialog widgetVar="dlgConfirmation" width="300px" >
            <f:facet name="header"><h:outputText value="#{lang['dialog.title.Confirmation']}" /></f:facet>
            <f:facet name="message"><h:outputText value="#{lang['dialog.message.AreYouSure']}" /></f:facet> 
            <h:form>
                <p:commandButton value="#{lang['button.Yes']}" action="#{userBean.doRemoveUser()}" styleClass="button-green" />
                <p:commandButton value="#{lang['button.No']}" onclick="PF('dlgConfirmation').hide()" styleClass="button-grey" />
            </h:form>
        </p:confirmDialog>

    </ui:define>

</ui:composition>